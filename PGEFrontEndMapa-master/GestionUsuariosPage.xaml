<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="IntegrarMapa.GestionUsuariosPage"
             Title="Gestión de Usuarios">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <!-- Sección de Búsqueda -->
            <Frame BackgroundColor="#495057" BorderColor="#dee2e6" Padding="15">
                <VerticalStackLayout Spacing="15">
                    <Label Text="Buscar usuario" FontSize="18" FontAttributes="Bold" TextColor="#333" />

                    <HorizontalStackLayout Spacing="10">
                        <Picker x:Name="pickerCriterio" Title="Buscar por..." WidthRequest="150" />
                        <Entry x:Name="entryBusqueda" Placeholder="Ingrese valor..." WidthRequest="200" />
                        <Button Text="Buscar" Clicked="OnBuscarClicked" BackgroundColor="#007bff" TextColor="White" />
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Frame>

            <!-- Lista de Usuarios Encontrados (solo visible cuando hay múltiples resultados) -->
            <Frame x:Name="listaUsuarios" BackgroundColor="#495057" BorderColor="#dee2e6" Padding="15" IsVisible="False">
                <VerticalStackLayout Spacing="15">
                    <Label Text="Selecciona un usuario:" FontSize="16" FontAttributes="Bold" TextColor="#333" />

                    <CollectionView x:Name="collectionUsuarios" SelectionChanged="OnUsuarioSeleccionado" SelectionMode="Single">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="10" ColumnDefinitions="*, Auto">
                                    <VerticalStackLayout Grid.Column="0">
                                        <Label Text="{Binding Nombre}" FontAttributes="Bold" />
                                        <Label Text="{Binding Email}" FontSize="14" TextColor="#666" />
                                        <Label Text="{Binding Username}" FontSize="12" TextColor="#888" />
                                    </VerticalStackLayout>
                                    <Label Grid.Column="1" Text="{Binding Rol}" BackgroundColor="#e9ecef" 
                                           Padding="5,2" FontSize="12" TextColor="#495057" />
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <Button Text="Cancelar" Clicked="OnCancelarSeleccionClicked" BackgroundColor="#6c757d" TextColor="White" />
                </VerticalStackLayout>
            </Frame>

            <!-- Sección de Información del Usuario -->
            <Frame x:Name="seccionUsuario" BackgroundColor="#495057" BorderColor="#dee2e6" Padding="15" IsVisible="False">
                <VerticalStackLayout Spacing="15">
                    <Label Text="Información del Usuario" FontSize="18" FontAttributes="Bold" TextColor="#333" />

                    <Grid ColumnDefinitions="Auto, *" RowDefinitions="Auto, Auto, Auto, Auto" RowSpacing="10" ColumnSpacing="15">
                        <!-- Nombre -->
                        <Label Grid.Row="0" Grid.Column="0" Text="Nombre:" FontAttributes="Bold" />
                        <Label Grid.Row="0" Grid.Column="1" x:Name="lblNombre" Text="-----" />

                        <!-- Email -->
                        <Label Grid.Row="1" Grid.Column="0" Text="Email:" FontAttributes="Bold" />
                        <Label Grid.Row="1" Grid.Column="1" x:Name="lblEmail" Text="-----" />

                        <!-- Usuario -->
                        <Label Grid.Row="2" Grid.Column="0" Text="Usuario:" FontAttributes="Bold" />
                        <Label Grid.Row="2" Grid.Column="1" x:Name="lblUsuario" Text="-----" />

                        <!-- Rol -->
                        <Label Grid.Row="3" Grid.Column="0" Text="Rol:" FontAttributes="Bold" />
                        <Picker Grid.Row="3" Grid.Column="1" x:Name="pickerRol" />
                    </Grid>

                    <!-- Botones de acción -->
                    <Grid ColumnDefinitions="*, *" ColumnSpacing="10">
                        <Button Grid.Column="0" Text="Guardar cambios" Clicked="OnGuardarClicked" 
                                BackgroundColor="#28a745" TextColor="White" />
                        <Button Grid.Column="1" Text="Eliminar usuario" Clicked="OnEliminarClicked" 
                                BackgroundColor="#dc3545" TextColor="White" />
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- Loading Indicator -->
            <ActivityIndicator x:Name="loadingIndicator" IsVisible="False" IsRunning="False" Color="#007bff" />

            <!-- Botón Volver -->
            <Button Text="Volver" Clicked="OnVolverClicked" BackgroundColor="#6c757d" TextColor="White" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>